<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Control Inteligente de Pérdidas</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{margin:0;background:#0f172a;color:#e5e7eb;font-family:Arial}
header{padding:16px;background:#020617;border-bottom:1px solid #1e293b}
main{padding:16px;display:flex;flex-direction:column;gap:16px}
select,button{padding:10px;background:#020617;color:#e5e7eb;border:1px solid #334155;border-radius:6px}
.section{background:#020617;border-radius:10px;padding:14px}
.alerta{border-left:6px solid #dc2626}
.advertencia{border-left:6px solid #facc15}
.card{border:1px solid #334155;border-radius:8px;padding:10px;margin-top:8px}
h3{margin:0 0 8px}
small{color:#94a3b8}
</style>
</head>
<body>

<header>
<h2>Control Inteligente de Pérdidas – RAG & Donaciones</h2>
</header>

<main>

<div>
<select id="dias">
<option value="7">7 días</option>
<option value="14">14 días</option>
<option value="30">30 días</option>
</select>

<select id="sector">
<option value="ALL">Toda la sucursal</option>
<option>CARNICERIA</option>
<option>VERDULERIA</option>
<option>FIAMBRES Y LACTEOS</option>
</select>

<button onclick="generar()">Generar reporte</button>
</div>

<div id="resultado"></div>

</main>

<script>
const URL = "PEGÁ_ACÁ_TU_URL_EXEC";

async function generar(){
  const dias=document.getElementById("dias").value;
  const sector=document.getElementById("sector").value;
  const res=await fetch(`${URL}?dias=${dias}&sector=${sector}`);
  const data=await res.json();
  const box=document.getElementById("resultado");
  box.innerHTML="";

  box.innerHTML+=`
  <div class="section">
  <h3>Resumen últimos ${dias} días</h3>
  <small>Sector: ${data.resumen.sector}</small><br>
  Alertas: ${data.resumen.total_alertas} |
  Advertencias: ${data.resumen.total_advertencias}
  </div>`;

  if(data.alertas.length){
    box.innerHTML+=`<div class="section alerta"><h3>Alertas</h3></div>`;
    data.alertas.forEach(p=>box.innerHTML+=card(p));
  }

  if(data.advertencias.length){
    box.innerHTML+=`<div class="section advertencia"><h3>Advertencias</h3></div>`;
    data.advertencias.forEach(p=>box.innerHTML+=card(p));
  }

  if(data.ranking.length){
    box.innerHTML+=`<div class="section"><h3>Top productos del período</h3></div>`;
    data.ranking.forEach(p=>box.innerHTML+=card(p));
  }

  if(data.mas_frecuente){
    box.innerHTML+=`<div class="section"><h3>Producto más frecuente</h3>${card(data.mas_frecuente)}</div>`;
  }

  if(data.mas_rag){
    box.innerHTML+=`<div class="section"><h3>Producto más RAG</h3>${card(data.mas_rag)}</div>`;
  }
}

function card(p){
  return `<div class="card">
  <strong>${p.producto}</strong> (${p.sku})<br>
  ${p.nivel || ""} – ${p.motivo || ""}<br>
  Evento máx: ${p.cantidad_evento_max} ${p.unidad}<br>
  Acumulado: ${p.cantidad_acumulada_periodo}
  </div>`;
}
</script>

</body>
</html>