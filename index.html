<script>
const API_URL = "https://script.google.com/macros/s/AKfycby4QCiHE9BI496qmBwY7-ZnCFKUSkV1UPBXegu8xAnq18s4kFfgIBLCVaZtum585K6IUQ/exec";

function toggleSector() {
  const toggle = document.getElementById("sectorToggle").value;
  document.getElementById("sector").disabled = toggle !== "one";
}

async function generarReporte() {
  const periodo = document.getElementById("periodo").value;
  const sectorToggle = document.getElementById("sectorToggle").value;
  const sector = document.getElementById("sector").value;
  const box = document.getElementById("resultado");

  box.innerHTML = "";

  if (!periodo) {
    box.innerHTML = "<div class='alert-yellow'>Seleccion√° un per√≠odo.</div>";
    return;
  }

  try {
    box.innerHTML = "<p>‚è≥ Cargando datos reales...</p>";

    const res = await fetch(API_URL);
    if (!res.ok) throw new Error("Error al consultar Google Script");

    const data = await res.json();

    if (!Array.isArray(data) || data.length === 0) {
      box.innerHTML = "<p class='ok'>‚úî No hay datos para el per√≠odo seleccionado.</p>";
      return;
    }

    box.innerHTML = `
      <p>üìä Reporte √∫ltimos <strong>${periodo} d√≠as</strong></p>
      <p>üìç Sector: <strong>${sectorToggle === "one" ? sector : "Toda la sucursal"}</strong></p>
    `;

    let alertas = 0;

    data.forEach(row => {
      if (Number(row.Cantidad) >= 24) {
        alertas++;
        box.innerHTML += `
          <div class="alert-red">
            üî¥ ${row.Descripcion_pro} ‚Äì ${row.Cantidad} ${row.Unidad}
          </div>
        `;
      }
    });

    if (alertas === 0) {
      box.innerHTML += "<p class='ok'>‚úî No se detectaron alertas.</p>";
    }

  } catch (err) {
    console.error(err);
    box.innerHTML = `
      <div class="alert-red">
        ‚ùå Error cargando datos reales.<br>
        Revis√° la URL del Google Script o permisos.
      </div>
    `;
  }
}
</script>